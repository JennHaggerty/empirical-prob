<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="https://bootswatch.com/4/sandstone/bootstrap.css">
	<style>
		body {
			background-color: #f9f9f9;
		}

		#accordion-btn {
			width: 100%;
			color: #343436;
			background: #ffca28;
			margin: 0 auto;
			padding: 1em;
			font-size: 14px;
			font-weight: unset;
			text-transform: inherit;
			text-decoration: none;
			text-shadow: unset;
		} 
		#accordion-btn:hover {
			background: #d6ac2b;
		}
		#theString {
			word-wrap: break-word;
		}
		#accordion-num {
			font-weight: bold;
		}

		.closed {
			display: none;
		}
		.open {
			display: block;
		}
		.num-input {
			text-align: right;
			padding: .5em 1.5em;
		}
		.form-control {
			width: 15%;
			display: inline-block;
		}
		.results-row {
			text-align: center;
		}
		.wrapper {
			background-color: white;
			padding: 1em;
			border-radius: 6px;
		}
		.newString {
			text-align: right;
			margin: .5em;
		}
		@media only screen and (max-width: 1024px) {
			#error {
				white-space: pre;
				float: right;
			}
			body {
				margin: 1em;
			}
			button#accordion-btn {
			}
			input#letter-input {
				text-align: center;
			  width: 100%;
			}
			.container-fluid {
				margin: 40px 0;
			}
		}
		@media only screen and (min-width: 1024px) {
			body {
				width: 60%;
				margin: 0 auto;
			}
		}
	</style>
</head>
<body>
	<div class="wrapper">
		<div id="resultsContainer" class="container-fluid">
			<div class="row results-row">
				<div class="col-sm">
					<h2>
						<span id="jumbospan1">
							Find the Empirical Probability
						</span>
						<span id="jumbospan2" class="closed">
							Empirical Probability: <font id="results"></font>
						</span>
					</h2>
				</div>
			</div>
		</div>

		<div id="formContainer" class="container-fluid">
			<div class="row">
				<div class="col-sm">
					<label for="letter-input">Input a letter to find its empirical probability of being selected at random from the string below:</label>
					<input id="letter-input" class="form-control letter" type="text" required="yes" maxlength="1" onkeyup="javascript:handleInput(this.value);"></input>
					<text id="error" class="closed text-danger"></text>
				</div>
			</div>
		</div>

		<div id="accordionContainer" class="container-fluid">
		  <div class="card">
		    <div class="card-header">
					<div class="row">
						<div class="col-sm">
		      		  <button id="accordion-btn" onclick="handleClick();" class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
									Click to see the string created by converting the number <text id="accordion-num">123</text>
		      		  </button>
						</div>
					</div>
		    </div>
		    <div id="collapseOne" class="closed" aria-labelledby="headingOne" data-parent="#accordion">
		      <div class="card-body" id="theString"></div>
		    </div>
				<div class="row">
					<div class="col-sm newString">
						<label for="new-string">Want to try a different number? (max: 999)</label> 
						<input id="num-input" class="form-control number" type="text" maxlength="3" onkeyup="javascript:handleNumInput(this.value);">
					<text id="num-error" class="closed text-danger"></text>
					</div>
				</div>
		  </div>
		</div>
	</div>

<script type="text/javascript">
var theNumber = 123;
var results = document.getElementById("results");

buildString(theNumber);
//console.log("letter: " + letter);
//console.log("theString.length : " + theString.length );
//console.log("theString : " + theString );
// BEGIN FUNCTIONS 
function handleNumInput(arr){
	var num = arr; // 999
  var numDisplay = document.getElementById('accordion-num');

	numDisplay.innerHTML = num;
	validateNumForm(num);
	buildString(num);
	findProbability(num);

	return;
}
function handleInput(arr){
	var letter = arr; // e
	var probability = findProbability(arr);

	clearStyling(); // remove styling related to percentage

	//if(){}
	if (validateForm(letter) != false){
		document.getElementById('resultsContainer').classList.remove('closed');
		document.getElementById('jumbospan1').classList.add('closed');
		document.getElementById('jumbospan2').classList.remove('closed');

		addStyling(probability); // color percentage

		results.innerHTML = probability += "%"; // populate div
	}
	return;
}
function addStyling(arr){
	var rounded = (arr * 100).toFixed(); // 0.1886 => 19

	if (rounded < 3){
		results.classList.add("text-danger");
	} else if (rounded < 7) {
		results.classList.add("text-warning");
	} else {
		results.classList.add("text-success");
	}
}
function clearStyling(){
	var classList = results.classList.contains("text-danger")
								||results.classList.contains("text-warning")
								||results.classList.contains("text-success"); 
	if (classList) {
		results.classList.remove("text-success");
		results.classList.remove("text-danger");
		results.classList.remove("text-warning");
	}
}
function findProbability(arr, err){ // e
	var theString 	= document.getElementById( "theString" ).innerHTML; //onetwothree...onehundredtwentythree
	if(typeof(arr) != "string"){
		console.log("Argument not a string");
		return err;
	} else {
		occurrenceOfLetter = theString.split(arr).length-1; // e = 233
		probability = occurrenceOfLetter/theString.length; // 0.1886...
		//probability = probability.toFixed(2)*100; // 0.1886 => 0.19 => 19
		probability = probability*100; // 0.1886 => 0.19 => 19
		return probability;
	}
}
function buildString(arr){
	var theString = '';
	for(var i = 1; i <= arr; i++) {
		var convertedNum = NumberToWords(i); // one hundred twenty three
	
		theString += convertedNum.replace(/\s/g,''); // onehundredtwentythree
	}
	var stringDiv = document.getElementById('theString');
	stringDiv.innerHTML = theString;

	return theString;
}
function NumberToWords(number){ // 123
	var num = new String(number); // "123"
	var splt = num.split(""); // "1", "2", "3"
	var newNumber = splt.reverse(); // "3", "2", "1"
	var first = ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
	var two = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
	var tens = ['', 'ten', 'twenty ', 'thirty ', 'forty ', 'fifty ', 'sixty ', 'seventy ', 'eighty ', 'ninety '];
 
	var word = new Array();
	var count = 0;
 
	for(i=0; i < newNumber.length; i++){
		switch(i){
			case 0: // newNumber = 3,2,1   word[count] = three
        if ((newNumber[i] == 0) || (newNumber[i + 1] == 1)) { 
            word[count] = '';
        }
        else {
            word[count] = first[newNumber[i]];
        }
				word[count] = word[count];

      	break;
 
			case 1: // newNumber = 3,2,1   word[count] = twenty
				Tens();

        break;
 
			case 2: // newNumber = 3,2,1   word[count] = one hundred
				if (newNumber[i] == 0) {
					word[count] = '';
				}
				else if ((newNumber[i - 1] == 0) || (newNumber[i - 2] == 0)) {
					word[count] = first[newNumber[i]] + " hundred ";
				}
				else {
					word[count] = first[newNumber[i]] + " hundred ";
				}

        break;
			default: break;
		}
		count++;
	}
 
	function Tens() {
		if (newNumber[i] == 0) { 
			word[count] = ''; 
		}else if (newNumber[i] == 1) { 
			word[count] = two[newNumber[i - 1]]; 
		}else {
			word[count] = tens[newNumber[i]]; 
		}
	}
 
	word.reverse(); // ["three", "twenty" , "one hundred"] 
	var result = '';
	for(i=0; i < newNumber.length; i++){ // one hundred // one hundred twenty // one hundred twenty three 
		result = result + word[i];
	}

	//console.log(result);
	return result;
}
function validateNumForm(arr){
	var numForm = document.getElementById('num-input');
	var numFormInput = numForm.value;
	var results = document.getElementById("results");

	var errorDiv = document.getElementById("num-error");
	errorDiv.innerHTML = ""; // clear error msg

  if (!/^[0-9]*$/g.test(numFormInput)) {
		numForm.className = 'form-control is-invalid'; 
		errorDiv.classList.remove('closed'); // display err div
		errorDiv.innerHTML = " Must be a number."; // display err
    return false;
  } else if (numFormInput == '') {
		numForm.className = 'form-control'; 
		results.innerHTML = ""; // clear results on empty string
		return false;
	} else {
		numForm.className = 'form-control is-valid'; 
	}
	return;
}
function validateForm(arr){
	var letterForm = document.getElementById('letter-input');
	var letterFormInput = letterForm.value;
	var results = document.getElementById("results");
	var errorDiv = document.getElementById("error");
	//var letterFormInput = document.getElementById('letter-input').value;

	errorDiv.innerHTML = ""; // clear error msg

  if (!/^[a-zA-Z]*$/g.test(letterFormInput)) {
		letterForm.className = 'form-control is-invalid'; 
		errorDiv.classList.remove('closed'); // display err div
		errorDiv.innerHTML = " Must be a letter."; // display err
    return false;
  } else if (letterFormInput == '') {
		letterForm.className = 'form-control'; 
		results.innerHTML = ""; // clear results on empty string
		return false;
	} else {
		letterForm.className = 'form-control is-valid'; 
	}
	return;
}
function handleClick(e){ // because CDN can't be trusted to function
var card = document.getElementById('collapseOne');
	if(card.classList.contains('closed')){
		card.className = "open";
	} else {
		card.className = "closed";
	}
}
</script>
<!-- BEGIN SOCKET.IO -->
<script src="socket.io/socket.io.js"></script>
<script type="text/javascript">
	var socket = io();
	socket.on('fileChanged', function(msg) {
		document.location.reload(true);
	});
</script>
</body>
</html>
